{"version":3,"sources":["lighting/Lighting.js","functions/Math.js","terrain/Water.js","terrain/Terrain.js","player/PlayerMovement.js","player/PlayerCamera.js","player/Player.js","player/PlayerControls.js","App.js","index.js"],"names":["Lighting","props","Sky","distance","sunPosition","inclination","azimuth","intensity","castShadow","position","shadow-mapSize-width","shadow-mapSize-height","shadow-camera-far","shadow-camera-left","shadow-camera-right","shadow-camera-top","shadow-camera-bottom","perlin","rand_vect","theta","Math","random","PI","x","cos","y","sin","dot_prod_grid","vx","vy","g_vect","d_vect","this","gradients","smootherstep","interp","a","b","seed","memory","get","hasOwnProperty","xf","floor","yf","tl","tr","bl","br","xt","xb","v","Water","W","useControl","type","value","min","max","usePlane","rotation","args","ref","useFrame","current","receiveShadow","attach","color","side","THREE","transparent","opacity","Plane","canyons","wireframe","size","verts","amp","length","xShift","yShift","geometry","material","useConvexPolyhedron","mass","vertices","faces","map","height","z","_ModifyVertices","Terrain","PlayerMovement","forwardRef","STATS","api","C","forward","backward","left","right","jump","run","velocity","useRef","jumpCoolDown","direction","frontVector","sideVector","camEuler","calculateVelocity","set","FinalSpeed","speed","pan_speed","run_speed","subVectors","normalize","multiplyScalar","applyEuler","camera","inertia","jump_height","useEffect","subscribe","PlayerCamera","pos","player_height","moveCamera","PointerLockControls","Player","useSphere","useThree","useState","movement","setMovement","keys","KeyW","KeyS","KeyA","KeyD","Space","ShiftLeft","moveFieldByKey","key","handleKeyDown","e","m","code","handleKeyUp","document","addEventListener","removeEventListener","usePlayerControls","App","Provider","Canvas","shadowMap","gl","alpha","fov","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.0d8213e2.chunk.js","sourcesContent":["import React, { useRef } from 'react'\r\nimport { Sky } from '@react-three/drei'\r\n\r\nexport const Lighting = props => {\r\n  return (\r\n    <>\r\n      {/* <fog attach=\"fog\" args={['white', 0, 40]} /> */}\r\n      <Sky\r\n        distance={450000}\r\n        sunPosition={[2.5, 8, 5]}\r\n        inclination={0}\r\n        azimuth={0.25}\r\n      />\r\n      <hemisphereLight intensity={0.4} />\r\n      <directionalLight\r\n        castShadow\r\n        position={[2.5, 8, 5]}\r\n        intensity={1.5}\r\n        shadow-mapSize-width={1024}\r\n        shadow-mapSize-height={1024}\r\n        shadow-camera-far={50}\r\n        shadow-camera-left={-10}\r\n        shadow-camera-right={10}\r\n        shadow-camera-top={10}\r\n        shadow-camera-bottom={-10}\r\n      />\r\n    </>\r\n  )\r\n}\r\n","export const math = (function () {\r\n  return {\r\n    rand_range: function (a, b) {\r\n      return Math.random() * (b - a) + a\r\n    },\r\n\r\n    rand_normalish: function () {\r\n      const r = Math.random() + Math.random() + Math.random() + Math.random()\r\n      return (r / 4.0) * 2.0 - 1\r\n    },\r\n\r\n    rand_int: function (a, b) {\r\n      return Math.round(Math.random() * (b - a) + a)\r\n    },\r\n\r\n    lerp: function (x, a, b) {\r\n      return x * (b - a) + a\r\n    },\r\n\r\n    smoothstep: function (x, a, b) {\r\n      x = x * x * (3.0 - 2.0 * x)\r\n      return x * (b - a) + a\r\n    },\r\n\r\n    smootherstep: function (x, a, b) {\r\n      x = x * x * x * (x * (x * 6 - 15) + 10)\r\n      return x * (b - a) + a\r\n    },\r\n\r\n    clamp: function (x, a, b) {\r\n      return Math.min(Math.max(x, a), b)\r\n    },\r\n\r\n    sat: function (x) {\r\n      return Math.min(Math.max(x, 0.0), 1.0)\r\n    },\r\n\r\n    in_range: (x, a, b) => {\r\n      return x >= a && x <= b\r\n    },\r\n  }\r\n})()\r\n\r\nexport let perlin = {\r\n  rand_vect: function () {\r\n    let theta = Math.random() * 2 * Math.PI\r\n    return { x: Math.cos(theta), y: Math.sin(theta) }\r\n  },\r\n  dot_prod_grid: function (x, y, vx, vy) {\r\n    let g_vect\r\n    let d_vect = { x: x - vx, y: y - vy }\r\n    if (this.gradients[[vx, vy]]) {\r\n      g_vect = this.gradients[[vx, vy]]\r\n    } else {\r\n      g_vect = this.rand_vect()\r\n      this.gradients[[vx, vy]] = g_vect\r\n    }\r\n    return d_vect.x * g_vect.x + d_vect.y * g_vect.y\r\n  },\r\n  smootherstep: function (x) {\r\n    return 6 * x ** 5 - 15 * x ** 4 + 10 * x ** 3\r\n  },\r\n  interp: function (x, a, b) {\r\n    return a + this.smootherstep(x) * (b - a)\r\n  },\r\n  seed: function () {\r\n    this.gradients = {}\r\n  },\r\n  memory: {},\r\n  get: function (x, y) {\r\n    if (this.memory.hasOwnProperty([x, y])) return this.memory[[x, y]]\r\n    let xf = Math.floor(x)\r\n    let yf = Math.floor(y)\r\n    //interpolate\r\n    let tl = this.dot_prod_grid(x, y, xf, yf)\r\n    let tr = this.dot_prod_grid(x, y, xf + 1, yf)\r\n    let bl = this.dot_prod_grid(x, y, xf, yf + 1)\r\n    let br = this.dot_prod_grid(x, y, xf + 1, yf + 1)\r\n    let xt = this.interp(x - xf, tl, tr)\r\n    let xb = this.interp(x - xf, bl, br)\r\n    let v = this.interp(y - yf, xt, xb)\r\n    this.memory[[x, y]] = v\r\n    return v\r\n  },\r\n}\r\nperlin.seed()\r\n","import * as THREE from 'three'\r\nimport React from 'react'\r\n\r\nimport { useFrame } from 'react-three-fiber'\r\nimport { useControl } from 'react-three-gui'\r\nimport { usePlane } from 'use-cannon'\r\n\r\nexport function Water() {\r\n  const mapWidth = 10000,\r\n    mapLength = 10000\r\n  const vX = 32\r\n\r\n  const W = useControl('Water Level', {\r\n    type: 'number',\r\n    value: -0.5,\r\n    min: -5,\r\n    max: 5,\r\n  })\r\n\r\n  const [ref, api] = usePlane(() => ({\r\n    position: [0, W, 0],\r\n    rotation: [-Math.PI / 2, 0, 0],\r\n    args: [mapWidth, mapLength, vX, vX],\r\n  }))\r\n\r\n  useFrame(() => {\r\n    ref.current.position.y = W\r\n    // api.position.set([0, W, 0])\r\n  })\r\n\r\n  return (\r\n    <mesh ref={ref} receiveShadow>\r\n      <planeBufferGeometry\r\n        attach=\"geometry\"\r\n        args={[mapWidth, mapLength, vX, vX]}\r\n      />\r\n      <meshStandardMaterial\r\n        attach=\"material\"\r\n        color=\"#010178\"\r\n        side={THREE.DoubleSide}\r\n        transparent\r\n        opacity={0.5}\r\n      />\r\n    </mesh>\r\n  )\r\n}\r\n","import React from 'react'\r\nimport * as THREE from 'three'\r\nimport { useControl } from 'react-three-gui'\r\n\r\nimport { perlin } from '../functions/Math'\r\nimport { Water } from './Water'\r\nimport { useConvexPolyhedron } from 'use-cannon'\r\nimport { useFrame } from 'react-three-fiber'\r\n\r\nfunction _ModifyVertices(geometry, amp, length, canyons, xShift, yShift) {\r\n  geometry.vertices.map(v => {\r\n    let height = amp * perlin.get(length * v.x + xShift, length * v.y + yShift)\r\n\r\n    if (canyons) {\r\n      height += Math.floor(height)\r\n    }\r\n\r\n    v.z = height\r\n  })\r\n}\r\n\r\nconst Plane = props => {\r\n  const canyons = useControl('Canyons', {\r\n    type: 'boolean',\r\n    value: false,\r\n  })\r\n  const wireframe = useControl('Wireframe', {\r\n    type: 'boolean',\r\n    value: true,\r\n  })\r\n  const size = useControl('Map Size', {\r\n    type: 'number',\r\n    value: 60,\r\n    min: 10,\r\n    max: 60,\r\n  })\r\n  const verts = useControl('Vertices', {\r\n    type: 'number',\r\n    value: 30,\r\n    min: 10,\r\n    max: 100,\r\n  })\r\n  const amp = useControl('Amplitude', {\r\n    type: 'number',\r\n    value: 9.25,\r\n    min: 0,\r\n    max: 50,\r\n  })\r\n  const length = useControl('Length', {\r\n    type: 'number',\r\n    value: 0.03,\r\n    min: 0,\r\n    max: 0.5,\r\n  })\r\n\r\n  const xShift = useControl('X-Shift', {\r\n    type: 'number',\r\n    value: 0,\r\n    min: -5,\r\n    max: 5,\r\n  })\r\n  const yShift = useControl('Y-Shift', {\r\n    type: 'number',\r\n    value: 0,\r\n    min: -5,\r\n    max: 5,\r\n  })\r\n\r\n  const geometry = new THREE.PlaneGeometry(size, size, verts, verts)\r\n\r\n  const material = new THREE.MeshBasicMaterial({\r\n    color: 'grey',\r\n    side: THREE.DoubleSide,\r\n    wireframe: wireframe,\r\n  })\r\n\r\n  const [ref] = useConvexPolyhedron(() => ({\r\n    mass: 0,\r\n    type: 'Dynamic',\r\n    rotation: [Math.PI / 2, 0, Math.PI / 2],\r\n    position: [0, 0, 0],\r\n    args: [geometry.vertices, geometry.faces],\r\n  }))\r\n\r\n  useFrame(() => {})\r\n\r\n  _ModifyVertices(geometry, amp, length, canyons, xShift, yShift)\r\n\r\n  return (\r\n    <mesh\r\n      ref={ref}\r\n      args={[geometry, material]}\r\n      {...props}\r\n      castShadow\r\n      receiveShadow\r\n    />\r\n  )\r\n}\r\n\r\nexport const Terrain = () => {\r\n  return (\r\n    <>\r\n      <Plane rotation={[Math.PI / 2, 0, Math.PI / 2]} />\r\n      <Water />\r\n    </>\r\n  )\r\n}\r\n","import { useEffect, useRef } from 'react'\r\n\r\nimport * as THREE from 'three'\r\nimport { useFrame } from 'react-three-fiber'\r\n\r\nimport { forwardRef } from 'react'\r\n\r\nexport const PlayerMovement = forwardRef((props, ref) => {\r\n  const STATS = props.STATS\r\n  const api = props.api\r\n  const {forward, backward, left, right, jump, run} = props.C\r\n\r\n  const velocity = useRef([0, 0, 0])\r\n  const position = useRef([0, 0, 0])\r\n\r\n  //no continuous jumping\r\n  const jumpCoolDown = useRef()\r\n\r\n  const direction = new THREE.Vector3()\r\n  const frontVector = new THREE.Vector3()\r\n  const sideVector = new THREE.Vector3()\r\n\r\n  const camEuler = new THREE.Euler()\r\n\r\n  const playerOnGround = () => {\r\n    return position.current[1] < 1\r\n  }\r\n\r\n  const applyFriction = () => {\r\n    velocity.current[0] -= velocity.current[0] / STATS.inertia\r\n    velocity.current[2] -= velocity.current[2] / STATS.inertia\r\n  }\r\n\r\n  const calculateVelocity = () => {\r\n    frontVector.set(0, 0, backward - forward)\r\n    sideVector.set(left - right, 0, 0)\r\n    camEuler.set(0, 0, 0)\r\n\r\n    let FinalSpeed = STATS.speed\r\n\r\n    if (left || right) {\r\n      FinalSpeed = STATS.pan_speed()\r\n    } else if (run) {\r\n      FinalSpeed = STATS.run_speed()\r\n    }\r\n\r\n    direction\r\n      .subVectors(frontVector, sideVector)\r\n      .normalize()\r\n      .multiplyScalar(FinalSpeed)\r\n      .applyEuler(props.camera.rotation)\r\n\r\n    applyFriction()\r\n\r\n    const v = [\r\n      velocity.current[0] + direction.x / STATS.inertia,\r\n      velocity.current[1],\r\n      velocity.current[2] + direction.z / STATS.inertia,\r\n    ]\r\n\r\n    if (playerOnGround()) {\r\n      api.velocity.set(v[0], v[1], v[2])\r\n\r\n      if (!jump) jumpCoolDown.current = false\r\n      if (jump && !jumpCoolDown.current) {\r\n        jumpCoolDown.current = true\r\n        api.velocity.set(v[0], STATS.jump_height(), v[2])\r\n      }\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    api.velocity.subscribe(v => (velocity.current = v))\r\n    api.position.subscribe(v => (position.current = v))\r\n  }, [])\r\n\r\n  useFrame(() => {\r\n    calculateVelocity()\r\n  })\r\n\r\n  return null\r\n})\r\n","import React from 'react'\r\n\r\nimport { PointerLockControls } from '@react-three/drei'\r\nimport { forwardRef } from 'react'\r\nimport { useFrame } from 'react-three-fiber'\r\n\r\nexport const PlayerCamera = forwardRef((props, ref) => {\r\n  function moveCamera() {\r\n    const pos = ref.current.position\r\n\r\n    props.camera.position.y = pos.y + props.STATS.player_height\r\n\r\n    props.camera.position.x = pos.x\r\n\r\n    props.camera.position.z = pos.z\r\n  }\r\n\r\n  useFrame(() => {\r\n    moveCamera()\r\n  })\r\n\r\n  return <PointerLockControls/>\r\n})\r\n","import React, { forwardRef } from 'react'\r\nimport { useThree } from 'react-three-fiber'\r\n\r\nimport { useSphere } from 'use-cannon'\r\n\r\nimport { PlayerMovement } from './PlayerMovement'\r\nimport { PlayerCamera } from './PlayerCamera'\r\nimport { usePlayerControls } from './PlayerControls'\r\n\r\nexport default function Player(props) {\r\n  const STATS = {\r\n    speed: 5,\r\n    player_height: 2.5,\r\n    run_speed: () => STATS.speed * 2,\r\n    pan_speed: () => STATS.speed * 0.6,\r\n    jump_height: () => STATS.player_height * 3,\r\n    inertia: 5,\r\n  }\r\n\r\n  // Player hitbox\r\n  const [ref, api] = useSphere(() => ({\r\n    mass: 1,\r\n    type: 'Dynamic',\r\n    position: [0, STATS.player_height, 0],\r\n    size: [1, 32, 32],\r\n    ...props,\r\n  }))\r\n\r\n  const { camera } = useThree()\r\n  const {\r\n    forward,\r\n    backward,\r\n    left,\r\n    right,\r\n    jump,\r\n    run,\r\n  } = usePlayerControls()\r\n\r\n  return (\r\n    <group>\r\n      <PlayerCamera ref={ref} STATS={STATS} camera={camera}/>\r\n      <PlayerMovement\r\n        ref={ref}\r\n        api={api}\r\n        STATS={STATS}\r\n        camera={camera}\r\n        C={{ forward, backward, left, right, jump, run}}\r\n      />\r\n    </group>\r\n  )\r\n}\r\n","import { useState, useEffect } from 'react'\r\n\r\nexport const usePlayerControls = () => {\r\n  const [movement, setMovement] = useState({\r\n    forward: false,\r\n    backward: false,\r\n    left: false,\r\n    right: false,\r\n    jump: false,\r\n    run: false,\r\n  })\r\n\r\n  const keys = {\r\n    KeyW: 'forward',\r\n    KeyS: 'backward',\r\n    KeyA: 'left',\r\n    KeyD: 'right',\r\n    Space: 'jump',\r\n    ShiftLeft: 'run',\r\n  }\r\n\r\n  const moveFieldByKey = key => keys[key]\r\n\r\n  useEffect(() => {\r\n    const handleKeyDown = e =>\r\n      setMovement(m => ({ ...m, [moveFieldByKey(e.code)]: true }))\r\n\r\n    const handleKeyUp = e =>\r\n      setMovement(m => ({ ...m, [moveFieldByKey(e.code)]: false }))\r\n\r\n    document.addEventListener('keydown', handleKeyDown)\r\n    document.addEventListener('keyup', handleKeyUp)\r\n\r\n    return () => {\r\n      document.removeEventListener('keydown', handleKeyDown)\r\n      document.removeEventListener('keyup', handleKeyUp)\r\n    }\r\n  }, [])\r\n  return movement\r\n}\r\n","import React from 'react'\r\nimport { Controls } from 'react-three-gui'\r\n// import { OrbitControls, softShadows } from '@react-three/drei'\r\n\r\nimport { Lighting } from './lighting/Lighting'\r\nimport { Terrain } from './terrain/Terrain'\r\nimport Player from './player/Player'\r\nimport { Physics } from 'use-cannon'\r\n\r\nimport './App.css'\r\n\r\n// softShadows()\r\n\r\nexport default function App() {\r\n  return (\r\n    <Controls.Provider>\r\n      <Controls.Canvas\r\n        shadowMap\r\n        gl={{ alpha: false }}\r\n        camera={{ position: [30, 20, 30], fov: 90 }}\r\n      >\r\n        <Lighting />\r\n        <Physics>\r\n          <Player />\r\n          <Terrain />\r\n        </Physics>\r\n      </Controls.Canvas>\r\n      <Controls />\r\n    </Controls.Provider>\r\n  )\r\n}\r\n","import React from 'react'\r\nimport ReactDOM from 'react-dom'\r\n\r\nimport App from './App'\r\n\r\nReactDOM.render(<App />, document.getElementById('root'))\r\n"],"sourceRoot":""}